<html>

<head>
    <title>Stream temp</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        #proxyStream {
            width: 600px;
            height: 200px;
            border: solid 1px black;
        }
    </style>
</head>

<body>
    <svg id="proxyStream"></svg>
</body>
<script src="proxying_stream.js"></script>
<script>
    const flowChartWidth = 600;
    const flowChartHeight = 200;

    function dataKeys() {
        ret = new Map()
        data.forEach(d => {
            for (var p in d) {
                ret.set(p, 0);
            }
        });
        ret.delete("time");
        r = []
        ret.forEach((v, k) => r.push(k));
        return r;
    }

    function updateFlowChart(data) {
        let stack = d3.stack().keys(dataKeys()).order(d3.stackOrderNone).offset(d3.stackOffsetWiggle);
        let series = stack(data);
        let xScale = d3.scaleLinear()
            .range([0, flowChartWidth]);
        console.log(series);

        let yScale = d3.scaleLinear()
            .domain([-30, 30])
            .range([flowChartHeight, 0]);

        let color = d3.scaleOrdinal()
            .domain(dataKeys())
            .range(d3.schemeCategory10);

        let area = d3.area()
            .x((d, i) => xScale(i))
            .y0((d) => yScale(d[0]))
            .y1((d) => yScale(d[1]));

        const svg = d3.select('#proxyStream');

        svg.append("g")
            .selectAll("path")
            .data(series)
            .join("path")
            .style("fill", (d, i) => color(i))
            .attr("d", area);

        console.log('Plotted');
        //svg.append("g")
        //    .call(xAxis);
    }

    let data = [{ "time": Date.parse("2019-11-25T23:34:09.184Z"), "18bfdaa96cc77b24": 5, "4ccff194d95142c1": 7, "a468d5959ff93323": 8 },
    { "time": Date.parse("2019-11-25T23:34:11.186Z"), "18bfdaa96cc77b24": 7, "4ccff194d95142c1": 6, "a468d5959ff93323": 6 },
    { "time": Date.parse("2019-11-25T23:34:13.183Z"), "18bfdaa96cc77b24": 4, "4ccff194d95142c1": 8, "a468d5959ff93323": 8 },
    { "time": Date.parse("2019-11-25T23:34:15.187Z"), "18bfdaa96cc77b24": 7, "4ccff194d95142c1": 8, "a468d5959ff93323": 4 },
    { "time": Date.parse("2019-11-25T23:34:17.189Z"), "18bfdaa96cc77b24": 7, "4ccff194d95142c1": 7, "a468d5959ff93323": 6 },
    { "time": Date.parse("2019-11-25T23:34:19.187Z"), "18bfdaa96cc77b24": 6, "4ccff194d95142c1": 9, "a468d5959ff93323": 4 },
    { "time": Date.parse("2019-11-25T23:34:21.189Z"), "18bfdaa96cc77b24": 6, "4ccff194d95142c1": 7, "a468d5959ff93323": 6 }];

    updateFlowChart(data);
</script>

</html>